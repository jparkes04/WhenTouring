# **WhenTouring.info**

**View artist's concert histories and predict when they might next perform near you.**

https://whentouring.info

---

## About

I built this Next.js web app in a little over a week as a hobby project. It uses the MusicBrainz and SetlistFM APIs to collect data on artist's concert histories, which you can then explore in an interactive map powered by MapLibre and MapTiler.

You can view predictions for when a given artist will likely next perform near a location based on this data. The predictions are generated by Gemini and only take into account previous events.

I also use MongoDB to store API responses for 3 days in order to limit usage of the SetlistFM API.

## Environment variables

You need to configure the following environment variables to run the application.

| Variable Name              | Description                                          |
| -------------------------- | ---------------------------------------------------- |
| APP_NAME                   | Name of the application (for MusicBrainz)            |
| APP_VERSION                | App version (for MusicBrainz)                        |
| CONTACT_ADDRESS            | Contact address (for MusicBrainz)                    |
| SETLISTFM_API_KEY          | [SetlistFM](https://www.setlist.fm/) API key         |
| MONGO_DB_CONNECTION_STRING | MongoDB connection string                            |
| GEMINI_API_KEY             | [Gemini API](https://aistudio.google.com/apikey) key |
| NEXT_PUBLIC_MAPTILER_KEY   | [Maptiler](https://www.maptiler.com/) API key        |

## Installation

### Install dependencies

`npm install`

### Create database

`node .\scripts\dbCreate.ts`

### Start the application

`npm run dev`

## Built with

- Next.JS
- Tailwind CSS
- [MapLibre](https://maplibre.org/maplibre-gl-js/docs/)
- [react-map-gl](https://visgl.github.io/react-map-gl/)
- [bottleneck](https://www.npmjs.com/package/bottleneck)
- MongoDB
- Maptiler
- SetlistFM API
- MusicBrainz API
- Google Gemini

---

## Project Reflection

The initial idea for this project came from using services such as Songkick, which notify you of upcoming concerts from artists you follow. I had also noticed Spotify beginning to promote upcoming concerts using a 3rd party API in their app. However, these services and integrations are only focused on upcoming concerts. There is a wealth of historical concert data available online, both from commercial sources and community-led platforms. I thought it would be a novel application of this data to display a given artist's concert history in a geographical heatmap or clustermap format, providing a visual representation of their touring patterns and frequent destinations. I also thought it would be interesting to experiment with generative AI tools to 'predict' future events based on these patterns. Learning and using traditional machine learning techniques for this purpose was outside the scope of this hobby project, but using a generative AI API allowed me to quickly implement the feature as a proof-of-concept.

I decided to build the application in Next.JS with TypeScript. I had written a small amount of React in the past, but gained much more experience using it on my industrial placement year. Next allowed me to write my app's frontend in React, and also make use of server-side rendering and API routes. This was a good fit given the use and manipulation of data from third party APIs that would be required. Given this was my first time working with the framework and due to the simplicity of the application, I used the Pages router. In the future I intend to explore the App Router variant of Next.js and the Server Components paradigm.

The project uses SetlistFM as a source for concert histories, and the MusicBrainz API for artist search. In order to call my API abstraction layers from the front-end, I made use of Next's `getServerSideProps` function. This was suitable since the data only needed to be fetched on initial page load. It also allowed an additional layer of protection for my API endpoints - they were not exposed as public API routes.

The Gemini prediction API was implemented as an API route. This was to provide interactivity on the results page, enabling the user to submit queries for different locations without any re-loads, and only using the intial fetch of concert data.

To avoid exceeding the low rate limit on the SetlistFM API by repeatedly querying the same artists (e.g. popular artists), I used MongoDB to cache its responses. All pages of the data are mapped to the `EventList` type and written as a record to MongoDB. This is queried before hitting the third-party API. The trade-off here is that the most recent events may not be in the cached data - which is stored for a few days by default.

I hosted the site on Vercel with the hobby plan for cost and ease of deployment.

## Potential Improvements

There are a number of potential improvements to consider for this project.

#### User search

User search is currently simplistic, selecting only the single first best match to the user's query. A better implementation would return a selection of the top matching artists and allow the user to choose one.

#### City lookup

The location field for the predictions feature is simply plaintext which gets included in the LLM prompt as such. A much better implementation would be to look-up cities from a record such as simplemaps.

#### Securing API routes

Since I am using the Gemini free plan, I have left the API route open. However, in practice, this route should include authorisation to ensure only permitted users can access the endpoint. This would require an authentication system for the app.

#### Data sanitation

Historical concert data and the user-submitted location values (particularly before city lookup is implemented) should be sanitised before being passed to the LLM in order to prevent abuse.

#### Testing

This project would benefit from end-to-end and/or unit testing.

#### Containerisation and deployment

There is an opportunity to explore containerisation of the app. This also offers a chance to configure CI/CD - building, containerising, and publishing to a cloud platform whenever there are changes. For a simple hobby project, I decided to host on Vercel for ease, but may return to this project to explore these skills in the future.

## Use of GenAI

I made use of GenAI as a learning tool through the development of this project. It accelerated my learning of new frameworks and language features by offering detailed descriptions and contextual explanations. It was also useful fo researching data sources and open-source tools/utilities.

I prefer the granularity-of-control of hand-written code and still believe that a fundamental understanding of your own work is essential and responsible, but found GenAI to be a useful supporting tool for development.
